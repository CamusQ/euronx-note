terminologies:
ISP	Internet Service Provider 互联网服务提供商
DSL:用户数字线Digital subscriber Line
TCP：Transmission Control Proto
UDP：User Datagram Protocol
SSL：Secure Sockets Layer
URL： Uniform Resource Locator 
CDN Content Distribution Network
relay：中继
RFC	Request For Comments
MSS	最大报文长度
HFC	Hybrid Fiber Coaxial混合光纤同轴电缆网
ICMP	Internet Control Message Protocol 因特网控制报文协议
MTU	最大传输单元
DHCP	Dynamic Host Configuration Protocol 动态主机配置协议
NAT	Network Address Translation 网络地址转换
CIDR	无类别域间路由 Classless Inter-Domain Routing
TTL	Time To Live的缩写,该字段指定IP包被路由器丢弃之前允许通过的最大网段数量
IDS	Intrusion Detection Systems 入侵检测系统
RIP	Routing Information Protocol路由选择信息协议
OSPF	Open Shortest Path First开放式最短路径优先（一个内部网关协议）
BGP	边界网关协议 Border Gateway Protocol
IGMP	因特网组管理协议 Internet Group Management Protocol
PPP     点对点协议 Point to Point Protocol 
MAC	Media Access Control 媒体访问控制，或称为物理地址
FEC	前向纠错 Forward Error Correction
CRC	循环冗余校验 Cyclic Redundancy Check
CSMA	Carrier Sense Multiple Access 载波侦听多路访问
CSMA/CA 带有碰撞避免的CSMA
CSMA/CD 有碰撞的
SIFS	Short interframe space 短帧间间隔 
DIFS	分布式IFS
GSM	全球移动通信系统Global System for Mobile Communication
GPRS	General Packet Radio Service 通用分组无线服务技术	
LTE	Long Term Evolution，长期演进
PCM	脉冲编码调制Pulse Code Modulation
DOCSIS  Data Over Cable Service Interface Specifications有线电缆数据服务接口规范
CMTS	(Cable Modem Terminal Systems 电缆调制解调器端接系统
ARP	地址解析协议 Address Resolution Protocol
PnP	即插即用 Plug and Play
MPLS	多协议标签交换 Multi-Protocol Label Switching
PPPoE	PPP over Ethernet
CDMA	Code Division Multiple Access 码分多址 
BER	Bit Error Ratio，比特出错概率
AP 	（无线网络）接入点access point
BS	base station
SNR	信噪比SIGNAL-NOISE RATIO
ARQ	自动重传请求 Automatic Repeat-reQuest
communication 通信
telecommunication 电信 通信包含电信
RTP	实时传输协议RTP Real time Transport Protocol
DES	Data Encryption Standard 数据加密标准 一种使用密钥加密的块算法
CBC	密码分组链接CBC Cipher block chaining
MAC	消息认证码 Message Authentication Code 
MD5	Message Digest Algorithm 消息摘要算法第五版
TLS	安全传输层协议 Transport Layer Security
SNTP	简单网络时间协议 Simple Network Time Protocol 


 

ITU	国际电信联盟  International Telecommunication Union 
IEEE	电气和电子工程师协会 Institute of Electrical and Electronics Engineers
IETF	国际互联网工程任务组 The Internet Engineering Task Force
ANSI	美国国家标准学会 AMERICAN NATIONAL STANDARDS INSTITUTE



ports：
25 SMTP
80	HTTP
8189	所有标准程序都不使用的
21	FTP（控制）
20	FTP（数据）
3306	MySQL
8080	Tomcat
1521	Oracle
53	dns
67	DHCP
25	telnet



protocal:
802.11	wifi
802.3	Ethernet


因特网组成
从结构上：链路，交换机，终端，基站等
从性质上：一种运行在端系统上的分布式应用提供服务的基础设施
端系统（主机）：每一个互联网的终端，如手机，电脑灯，端系统也可以被分为主机和服务器
网络核心；分组交换机和链路
在链路上传播的东西称为报文，每条保温杯分解为若干个分组，分批次发送
每一个ISP本质上由多个分组交换机和多段通信链路组成的网络
两台主机进行通信的时候要遵守同一个协议，这样才能相互读懂
一个协议定义了两个或多个通信实体之间交换报文格式和次序，以及报文发送，接收或其他事件所采用的动作

接入网：将端系统连接到最近的一台路由器
接入网的方式
1、DSL
2、FTTx
3、LAN
4、WiFi
5、蜂窝网
6、电缆卫星等
7，电话线，电视线
物理介质：双绞线，同轴电缆，光纤，电磁波
在分组转发的时候，多数分组交换机采用存储转发机制，在向输出链路转发之前必须先接受到整个分组
接收到的分组先存储在缓存中，如果换存满了还有新的分组进来，则这些分组会丢失（丢包）
a为分组平均速度，L表示分组大小，R表示链路传输速率，则La/R表示流量强度
当大于1时排队时间趋近于无穷大
电路交换，预留了端系统之间通信沿路径所需要的缓存，链路传输速率，所以比较麻烦，在电路中有频分复用和时分复用两种复用方式，频分可以将不同的频率分给不同的端系统，时分就像操作系统的时间片一样
因为很少会发生堵塞的情况，所以基本上都是使用分组交换，但是有些无法容忍排队丢包等行为的应用还在使用电路交换，比如电话
因特网的作用就是将每一个端系统都互相连接起来，但是这是不可能的，甚至不可能没一个ISP都互联，真是的情况是，全球仅有的十几个全球ISP互联，下级ISP连接到全球ISP（作为客户），并且付费并且有些全球性的互联网公司自己架设服务器，并且与全球ISP互联，可以减少费用，拥有更多的控制权

分组交换时延picture
处理时延：检查首部，导向对应链路
排队：
传输：从路由器推向链路
传播：在链路中向下一台路由器传输


*****************应用层*******************
端口号标识正在主机上运行的进程，IP号表示一台主机
套接字 = IP + 端口号
进程通过一个叫套接字的软件接口向网络发送和接收报文
套接字是进程和运输层协议之间的接口
网络应用（应用层）是计算机网络存在的理由
主流的应用程序体系结构
1、C/S模式，客户服务器，此模式中客户与客户不直接通信，在一个session中，发起通信的成为客户，等待联系的称为服务器
2、p2p
3、混合模式，例如即时通讯
运输层协议可以为应用提供的服务：可靠数据传输rdt，吞吐量，安全性，
应用层协议：定义了运行在不同端系统上的应用程序如何互相传递报文类型，语法，语义，如何发送，何时，如何响应
应用层协议是网络应用的一部分
以下是一些应用层协议
1、HTTP，应用于web，由两个程序实现，一个客户程序，一个服务器程序，dingyileweb客户向web服务器请求网页的方式
网页是由对象组成的，由基本的HTML文件对象和其他对象组成，每个对象都有唯一的URL，储存在，web服务器上
HTTP运行在TCP上，不用担心数据丢死，不保存客户信息，是一个无状态协议
HTTP采用两种连接方式
1、非持续连接
2、持续连接
HTTP与如何解释一个web页面无关（由浏览器执行）
连接过程
1、客户发起到服务器的TCP连接，服务器进行响应，发送响应报文
客户发送http请求报文
2、服务器检索，并且将对象封装进报文，发送响应报文
HTTP服务器通知tcp连接关闭
对于非持续连接，每次双方都要分配TCP缓冲和TCP变量，为服务器带来负担，HTTP默认采用带流水线的持续连接
用户与浏览器的交互，cookie，（识别用户）
初次访问时提供一个用户标识，后继会话中在HTTP中增加一行cookie首部，向服务器标识用户，在无状态的HTTP上建立了一个用户会话层
web缓存（代理服务器）配置用户浏览器，使得HTTP只想代理，如果代理中有对象，则返回该对象，否则代理与目标服务器建立TCP连接，并且在取回本地时在代理服务器上建立一个副本（缓存）
可见，代理服务器扮演着既是客户又是服务器的角色
使用代理可以减轻请求响应时间，减少通信量，不必急于增加带宽
代理服务器通过条件get保持对象的时效性，在获得请求的时候代理向服务器发送一个请求，如果自某个时间之后该对象被修改过了，则返回该对象，否则不返回
FTP协议，文件传输协议，用户和FTP服务器回话，向他发送或接收文件
HTTP和FTP都是文件传输协议，主要区别在于HTTP只用一个TCP连接，发送数据。FTP用一个传输控制信息，一个收发文件
邮件传输
用户 用户代理 SMTP 邮件服务器 SMTP 邮件服务器 （pop3|IMAP|HTTP） 用户代理 用户B
SMTP 将邮件直接从发送方的邮件服务器发送到接收方的邮件服务器，不经过中间服务器
一个邮件服务器扮演了客户和服务器两种角色
SMTP和HTTP
SMTP：推协议 用户发送 只能使用ASCII码 所有对象封装在一起
HTTP：拉协议 用户请求 无限制	      分别封装
SMTP只能发邮件，无法接收邮件，接收邮件时使用pop3或者imap，HTTP
pop3：最简单的邮件访问协议，用户将邮件下载到本地进行操作，不方便，将邮件删除只会删除本地，不会删除服务器上的邮件，服务器远程操作
HTTP：用户通过浏览器收发电子邮件，发送接收都通过HTTp，但是邮件服务器之间仍使用SMTP

dns
1、在对人友好的主机名和对路由器友好的ip地址上建立一个映射
2、对主机和邮件服务器提供别名，通过调用dns获得别名对应的规范主机名的ip
3、负载均衡
dns是
1、分层的dns服务器实现的分布式数据库
2、使主机可以查询该数据库的应用层协议
层次结构
1、根服务器
2、顶级域名，.com  .cn  .net等
3、//TOTO
本地dns服务器，在主机发送dns请求的时候，请求被发送至本地dns服务器，由他与各级服务器交互，最终获得目的地址返回给主机，起着代理的作用
dns缓存：当某个服务器接收到回答的时候可以将回答发送并且缓存，另一个主机型查询的时候就可以立即回复，在经过一定的时间后会删除缓存（比如三天）
主机 右箭头 进程（开发者控制） 套接字 TCP（操作系统控制） 因特网


*****************运输层*******************
为运行在不同主机上的应用进程提供直接的通信服务（逻辑通信）
将报文转换为运输层分组（运输层报文段segment）
运输层协议只工作在端系统，主机之间的通信由网络层承担
有两种运输层协议，TCP和UDP，运输层协议所能提供的最基本的功能为把数据从正确的套接字取出或交付到正确的套接字上，成为多路复用和多路分解

端口号是一个十六位的数（0~65535）0~1023是周知端口号，受限制
一般来首，客户端由运输层分配端口号，服务器分配一个固定的端口号套接字与进程之间并非总是一对一，一个web服务器进程通常为每个客户创建一个线程
UDP报文段（一般为8字节）
line1（表格）源端口号 目的端口号 
line2	     长度 检验和
UDP检验和为将所有数据相加，然后取反，作为检验和，在接受方将检验和和数据相加，如果结果为111111则传输没有出错
picture
可靠数据传输协议
停等协议
1.、无任何功能
2、解决了分组损坏，丢失的问题
接收方通过反馈信息ACK或NAK表达是否成功接收
3、解决了ACK丢失，损坏，和标识分组是新的还是旧的
丢失，损坏重传，加入分组编号
4、发送方分组丢失
加入计时器
带流水线的停等协议
新增，更多的序号
双方必须能在发送并且确认对方已经接受完所有的分组之前将其缓存
更复杂的处理分组丢失
回退N步（GBN）、将没有收到回复的X分组和之后的分组重传
从头到尾只有一个计时器，是最早的已发送但未被确认的分组的计时器
不会出现在第一个计时未结束之前需要启动第二个计时器的情况，因为在第一个发出去之后并计时时间内，不管后续有没有丢失，直到收到第一个分组的ACK，否则从第一个起全部从发
1、正常发送，正常接收
启动计时器
接收方收到
接收方回复正确ACK
接收方窗口右移（窗口只有一个单位）
发送方窗口右移
停止计时器
2、丢包
启动计时器
丢包
接收方不作回应
超时
重发
启动计时器
3、丢失中间的ACK
重复若干次1
接收方发送ack，窗口右移
ACK丢失
如果在计时结束之前接收到后来的ACK，发送方知道前面的分组都已经正常接收
窗口右移
停止计时器
（接收方收到冗余的分组后也要回复ACK，因为收到ACK后接收方的窗口才能滑动（或者后续的ACK））
4、丢失最后的ACK
无法通过后续的正确ACK来告诉发送方前面的已经正确收到
只能通过计时结束后重发
5、丢包1，丢ACK2
接收方窗口停在1
发送方窗口停在2（就算收到3的ACK也停在2）
选择重传的几种情况
1、丢失分组a
发送方的窗口停在a，就算收到后续正确ACK也不会移动（因为是独立的计时器）
接收方的窗口也停在a，但是会缓存后来的分组
计时结束重发
收到重发的分组后，接收方窗口直接跳到最后一个以确认的分组后，并且发送ACK
发送方的窗口也跳到最后一个已确认的分组之后
2、丢失ACKa
接收方窗口滑动，发送ACK
ACK丢失
发送方窗口暂停在a，时间结束后重发a
接收方收到冗余分组a，回复ACK
发送方窗口滑动
3、丢失分组a，ACK b
接收方将除了a的分组缓存，窗口不滑动
发送方将除了a，b的分组标记为收到，窗口不移动
重发

对于选择重传，分组序号是循环的，通过取模操作得到，所以窗口的长度必须 <= 序号范围的一半
例如：窗口长度 = 3，序号为1,2,3,1,2，....
情况1：上次回复的ACK全部丢失，发送方重发分组1
情况2：传输正常，发送方发新的分组1
接收方无法判断分组情况
假设窗口长度为2，则要收到1，必须先收到3，则表明已经进入到了下一个循环
假如分组在网络链路中停留了很长时间，然后重新出现，也会造成上述情况
解决方法是，为分组设置寿命TTL

TCP
主机之间的网络元素不会维持TCP连接状态，路由器智能看见数据报
TCP连接包括两台主机上的缓存，变量和与进程连接的套接字
TCP首部（一般为20字节）picture
TCP把数据看成为结构的字节流，分组序号就是该分组的第一个字节号
确认号为主机期望收到的序号
例如发送序号92，分组为8字节，回复ACK = 100，ACK表示期望下次收到的序号
假如收到期望之外的分组，可以缓存也可以丢弃，由编程人员决定
底下的ACK表示数据是否有效，每一个连接的第一个ACK为0，其余均为1
TCP的可靠数据传输
1、单一定时器
2、每发生一次超时，则计时器时长加倍顺利收到ACK时，计时器重置
3、不会像GBN一样在丢包后发送所有分组，而是在检测到3个冗余ACK之后立刻重新发送
4、SR失序缓存与GBN累计确认（只确认第一个丢失的字节号）的混合
TCP连接
//TODO
在第一次握手的时候，发送一个TCP报文段，不包含数据，发送方将SYN置于1，客户随机选择一个初始的分组序号seq_c。接收方接收方回复一个不含数据的报文段，将SYN置于1，服务器端随机选择一个分组序号seq_s，然后ACK = seq_c + 1
连接终止的时候将FIN置于1，并且在服务器收到终止请求之后开始释放资源，并且进行回复，客户收到回复之后释放资源
流量控制（缓解接收方流量溢出）
通过控制接受窗口的大小
接收窗口大小 = 接受缓存大小 - 接收但未确认大小
发送但未确认大小 <= 接收窗口
假设接收方窗口已满（接收窗口 = 0），将告诉发送方停止发送，此时发送方将一直尝试发送只有一个字节的确认报文，直到回复接收窗口不等于0
拥塞控制（为了使运输层减少拥塞，提高效率）
拥塞的坏处
1、由于发送分组太多导致后来的分组在路由器处排队的时间趋于无穷大
2、丢包是拥塞的前兆，在阻塞的时候丢包导致重传造成更严重的阻塞
3、排队时间提高，导致未及时收发ACK，造成冗余分组，导致阻塞
4、丢包时，许多分组已经经过了多个路由器，造成早先的路由器做了无用功
两种方法控制拥塞
1、通过两个端系统交互来控制拥塞
2、通过网络层直接反馈给端系统来控制发送速率
TCP采用第一种，因为IP不会提供拥塞反馈信息
TCP拥塞控制
TCP通过维护发送窗口大小来控制发送速率
收到未确认的大小 <= MIN{发送窗口大小，接收窗口大小}
TCP通过超时或者多个冗余ACK来感知拥塞
TCP拥塞协议算法
超时可能只是ACK时延较大，而冗余ACK代表着肯定丢包，所以超时比冗余ACK更严重，直接进入慢启动，在窗口大小超过预先设置的阈值之后进入小心增长模式
老版TCP Tahoe 没有快随恢复模式，直接进入慢启动
新版TCP Reno 有快速恢复模式
TCP Vegas则是通过观察往返时间，在快要发生拥塞的时候适当降低速度
实际中慢启动阶段持续时间很短，因为式指数级增长
为了保证大量吞吐，TCP仅能容忍很小的报文丢失
TCP分配带宽的公平性仅体现在连接之间，如果一个应用具有更多的TCP连接，则会分到更多的带宽
UDP没有流量控制，会压制TCP的流量







*****************网络层*******************
网络层（主机与主机之间的逻辑通信）
网络层包括：IP协议，路由选择，报告差错和请求相应设施ICMP
网络层可能提供的服务：确保交付，有序，按时，确保最小带宽，安全
因特网采用数据报网络，不提供任何服务
网络层连接服务除了在端系统中，也在位于网络核心的路由器中实现
数据报网络，一个端系统要发送分组，将数据封装为运输层保温推进网络中，然后封装成网络层报文，无需建立连接，通过一系列路由器传递
家用路由器和路由器的区别
家庭无线路由器集成了AP + Switch + Firewall + Router + DNS + DHCP + PPPoE客户端的功能，只有一个出口
路由器可以只能路由，有多个出口
路由器有一个转发表将目的地的地址映射到链路接口，转发表可能在某个机器中执行，然后路由器下载，或者路由器自己计算转发表，但是都要接收路由选择协议报文来配置转发表
路由器不为每一个IP地址建立映射，而是在匹配某一个字段，分配到相应的接口
路由器不维持连接状态信息，但是在转发表中维持了转发状态信息1-5min更新一次
虚电路和数据报网络（表格）
路由器工作原理
转发是指将分组从一个输入链路接口转移到适当的输出接口，是一个路由器上的动作
路由选择是整个网络范围内的动作，决定分组从源到目的地所采取的端到端路径。
转发就像一个驾驶员在路口看路标决定怎么走，而路由选择就像驾驶员提前在家里规划路线
picture
输入端口
1、物理链路与路由器连接
2、与链路层交互
3、查询转发表，转发，排队
交换结构：将输入端口与输出端口连接，是路由器中的网络
路由选择处理器，执行路由选择协议，维护选择表和连接的链路状态信息
交换结构picture
网络范围内的路由选择平面是分布式的，不同部分执行在不同的路由器上并且彼此发送报文交互
IPv4一般为4 * 5个字节
table
版本号：表明是IPv4还是IPv6
首部长度，如果没有选项，一般是20字节
服务类型TOS，区分不同的IP分组，比如实时与非实时，一些要求低时延，高吞吐，可靠性等等
数据报长度，首部加数据长度，理论最大为2 ^ 16字节，但是实际上很少超过1500
标识，标志，片偏移，与IP分片有关，在分组大于链路层最大传输单元时，会将分组分成几个小部分（IPv6不允许分片，会提高处理时延）
寿命：确保分组不会一直在网络中循环，没经过一个路由器，TTL减一，到0时，分组将会被丢弃
上层协议：TCP或者UDP，协议号绑定网络层与运输层，端口号绑定运输层与应用层
首部检验和：对IP首部进行检验，在每台路由器上必须检验一次，因为TTL会改变
原则上，TCP/UDP和IP不一定运行在一个协议栈上，所以在TCP和IP都进行检验，而且IP只检查首部，TCP对整个分组检查
假如分组时一个TCP数据报，则一共有20 + 20字节的首部
分组分片
为了不超过MTU，于是将分组中的数据分成多个小分组，用单独的链路层帧封装，在端系统中重新组装
最后一片标志为0，其余分组的有效载荷为8的倍数，标志为1
分片可以被用于Dos攻击，发送不发送标志为零的片，在接受方式图重组时可能会崩溃，于是IPv6取消了分片
IPv4编址主机与物理链路之间的边界叫接口
一个IP地址技术上是与一个接口相关联的，而不是与主机或者路由器相关联的
IP地址长32位，用点分十进制记法书写，比如192.168.1.1
全球互联网中每台主机和路由器上的接口
，必须有一个全球唯一的IP地址（NAT除外）
且IP地址的一部分，由其连接中的子网决定
多台主机（可能）通过以太网交换机互联，然后与一台路由器相连，于是这几个主机接口，和路由器接口形成了一个子网
例如在同一个子网中的路由器IP为192.168.1.1，主机A的IP为192.168.1.4 主机B为192.168.1.8
他们拥有一部分相同的IP地址192.168.1为网络地址，剩余部分为主机地址
子网的地址记为192.168.1.0/24，称为子网掩码，写法为网络地址为1，主机地址为0，表示前24位是网络地址
192.168.1.0/24也可以写为255.255.255.0, 
负责向外网转发分组的第一跳路由器称为网关路由器
因特网的地址分配策略
1、分类编址法
网络地址被限定为8,16,24位，分别被称为A，B，C类网
例如192.168.1.1是C类网，只有一个字节的主机地址，可以容纳256 - 2台主机0.0.0.0表示当前设备的IP，255.255.255.255为广播地址
目的地址是广播地址时，路由器相当前的网络中所有主机转发该报文
2、无类别域间路由选择CIDR
不在固定网络地址的大小，对于有些需求来说，B类网太大，C类网太小
网络管理员从ISP处获得IP地址，ISP的IP地址是从全球性的权威机构获取的一片IP地址，并将其划分为多个子网
DHCP动态主机配置协议，用于主机自身获取IP地址
静态IP：用户自行填写IP地址，DNS服务器，子网掩码，网关，配置麻烦，但是是一个稳定的地址，不需要每次开机时重新分配
DHCP是一个应用层协议，基于UDP，是一个C/S协议
用于获取自身IP地址，子网掩码等网络配置信息
每一个子网都有一个DHCP服务器，如果没有的话，一般是路由器实现中继代理，代理知道DHCP服务器的地址
获取配置信息
1、DHCP服务器发现
客户以源：this，目的：广播，发送分组
2、DHCP服务器提供
DHCP服务器收到DHCP发现报文时，广播一个DHCP提供报文
3、客户选择一个DHCP服务器，并且向该服务器发送一个DHCP请求报文
4、DHCP ACK
服务器用DHCP ACK报文回应，可会可以使用该地址
当一个节点在子网之间移动时，与远程服务区的TCP连接将会断开
网络地址转换NAT
作用：
1、缓解了IPv4地址紧张的问题
2、解决了内外网通信的问题
在安装了NAT软件的路由器连接的子网中，主机IP地址仅在子网中有效，NAT路由器对外隐藏了内网的细节，所有对外的源IP均显示为（网关）路由器的IP
所有进入内网的报文的目的IP均为路由器的IP
路由器从ISP处DHCP服务器获得自身的IP地址，并且自身运行一个DHCP服务器
为NAT-DHCP路由器控制的家庭网络中的主机提供地址
路由器使用NAT转发表来区分不同的主机
NAT后的主机不能被主动找到，因为客户发来第一个报文的时候名没有建立转发表
解决方法
1、连接反转，假设B和C已经建立连接，则A可以通过B请求与C连接
2、NAT穿越
因特网控制报文协议 ICMP（ping程序）
主机和路由器用来彼此沟通网络层信息，不包含数据，但是包括网络是否可达，是否过期，损坏等控制信息，最初被设计于执行拥塞控制，但是TCP执行了这个任务，不再需要该功能。
ICMP被认为是IP协议的一部分，但是在体系结构上位于IP之上，因为ICMP报文承载在IP分组中

IPv6 4 * 10字节
picture
与IPv4的主要区别
1、更大的地址容量（基本不可能用完）
2、定长的首部，更低的处理时延
3、将数据看作流，并且用流标签加以区分（类似于IPv4的服务类型）
下一个首部：需要交付给哪个协议
4、不允许分片，如果超过MTU，则丢弃，并向发送方回复：分组太大
因为TCP/UDP自带校验，所以取消了校验
从IPv4到IPv6的迁移
1、双栈
网络层被设计为可以同时处理IPv4和IPv6的数据报，且仅有两台路由器都是IPv6使能时才会互相发送IPv6分组，其余情况将IPv6转换为IPv4分组，有可能会丢失部分首部字段
2、隧道
如果两台IPv6使能的路由器中间有IPv4使能路由器，则把整个分组封装在IPv4分组中，在接受节点打开并且为IPv6提供路由，封装后的IPv4首部源和目的分别为隧道头和隧道尾
路由选择算法
1、全局式（链路状态选择算法）
采用Dijkstra算法，计算两个节点之间的最短路径
计算的时候每个路由器都要知道跨越每条链路的代价
有可能出现的问题，多台路由器都发现某条链路代价最小，于是都将流量引导至该链路，导致该链路变得拥塞，在下一次运算的时候大家都避开该链路，导致没有流量经过链路，这种情况称为振荡，避免这种情况的一种做法是，让每台路由器发送链路状态的时间随机化
2、分散式（距离向量路由选择算法）
初始情况为每个节点的路由选择标的每一项为无穷大
每一个节点更新自己的表，将与自身邻接的节点的链路代价更新，然后将改变后的表发送给与自身改变代价的邻居，邻居根据表动态执行//TODO
层次件路由选择

1、随着路由器的规模增大，设计路由选择的计算，存储通信的开销变得十分巨大以至于没有贷款来发送数据
2、部分组织希望按照自己的意愿管理网络或者隐藏网络内部组织
通过自治系统AS来解决，每个AS由一组处于相同管理下的路由器组成，全部运行着相同的路由选择算法，拥有彼此的信息，每个AS内部通过网关路由器向AS转发分组，一个AS可能包含许多子网
自制系统之间的路由选择
1、如果只有一台路由器，则从该网关转发
2、如果有多台路由器
假设





*****************链路层*******************
节点与节点之间的通信（主机，路由器，交换机，接入点等）
两种链路层信道
1、广播信道（有限局域网，卫星网，HFC，WiFi）
2、PPP点对点两台路由器之间
链路层可能提供的服务
1、成帧
2、链路接入
3、可靠交付
4、差错检验和纠正
链路层实现在路由器中的线路卡中和路由器中的CPU的软件，网络适配器中，网络适配器现在一般集成在主板上，软件执行高级功能，硬件实现低级功能
差错检验和纠正（比特级）
1、奇偶校验
2、校验和（类似于运输层）
3、循环冗余检测
用于广播链路的多路访问协议
1、信道划分协议
时分，频分，码分
FDM将信道划分为不同的频段，并把每个频率分配给N个节点中的一个，每个节点具有R/N带宽
2、随机接入协议（ALOHA CSMA）//TODO
不划分信道，节点以全速发送，有碰撞时，节点等待一个随机时延后重新发送
直到无碰撞通过
时隙ALOHA（）
时间被划分为长度为L/R秒的时隙（类似于总线周期），节点只有在时隙起点传送，接电视同步的，如果发送遇到碰撞，跌点在实习结束之前检测到碰撞，以概率P在后续的每个时隙重传帧，直到无碰撞发送，与时分信道不同，当某节点是唯一活跃接电视，允许以全速R连续船速
ALOHA
节点之间不同步，有帧立刻传送，有碰撞立刻以概率P重传
效率仅为时隙ALOHA的一半
CSMA载波侦听多路访问
在CSMA中，发送帧时适配器先侦听，听到信道空闲（无信号能量从信道进入适配器）后
如果有别的节点正在发送，则停止发送
注意：并不是所有节点都在侦听就不会发生碰撞了，因为在空间上两个节点存在距离，侦听存在时延
CSMA/CD 带有碰撞检测的

轮流协议
M个节点活跃，每个节点的吞吐量接近如R/Mbps
1、轮询协议
在若干节点中定义一个主节点，主节点轮流发送报文询问是否需要发送数据，一个节点发送完后继续询问下一个
优点：消除了碰撞与空时隙
缺点：最大速度小于R（主节点询问占用带宽），主节点发生故障则网络崩溃
2、令牌传递协议
一个称为令牌的帧在节点之间以固定次序传递，如果有节点需要发送帧，则保留令牌，否则立即传出令牌，
优点：没有主节点，效率高于轮询
缺点：如果因故障节点没有释放令牌，则会导致许多额外恢复操作
因特网中的多路访问协议
交换局域网
链路层寻址和地址解析
MAC地址，主机或路由器的适配器的链路层地址（物理地址）
长度6字节，MAC地址被实际为永久的，但是也可以用软件修改
IEEE管理MAC空间，向厂商分配一块MAC地址，厂商自行将该块分配
地址解析协议ARP IP和MAC的转换 跨越网络层和链路层的协议
发送主机的ARP模块取处在相同局域网中的IP为输入，返回对应的MAC
ARP只为同一个子网的主机和路由器接口解析IP地址
主机，路由器的内存中存在一张ARP表，包含IP到MAC的映射
为很么接口除了有网络层地址还有MAC地址
1、局域网是为任何网络体系设置的，不只用于因特网
2、网络层地址保存在RAM中，掉电后要重新分配
假如目的iP不在ARP表中，源广播一个ARP分组，收到分组的适配器将ARP分组传递给ARP模块，如果匹配则返回一个响应ARP分组，源更新其ARP表

ARP表是自动建立的，不需要管理员分配
发送数据到子网以外，网络层IP是跨越整个网络的，而链路是一段一段的
源以网管的MAC作为目的，以目的的ip作为目的IP地址
源以ARP获得网关的MAC，帧被发送到目的子网的网关，网关通过ARP活的目的的MAC，然后发送到目的地
互联网中的有限局域网――以太网
历史
70年代，总线拓扑，利用同轴电缆互联
90年代，星型拓扑，使用双绞线与集线器相连（集线器作用于比特，是物理层设备，无论何时集线器收到一个比特，他想起他所有出口转发，如果同时从两个接口收到比特，则出现碰撞，发送方重传）
现在，集线器被交换机替代，是无碰撞的，双全工，交换机和节点可以同时发送而没有干扰
以太网帧
数据字段：承载46-1500字节的IP分组，如果IP分组小于46字节要填充到46字节，网络层接收方使用首部中的`长度`字段去除填充部分
类型：以太网可以承载IP之外的协议
前同步码：前7比特：10101010，最后一个比特10101011，接受适配器通过锁定前七个比特来同步发送方的时钟，最后一个比特暗示数据即将到来
以太网提供：不可靠，无连接服务，发送方与接收方不进行确认
各种不同的以太网
链路层交换机，接收链路层帧并将其转发到出链路
交换机对于子网中的主机和路由器是不可见的，他们并不知道交换机在转发
交换机与路由器一样在输出接口具有缓存
交换机借助于交换机表实现了过滤和转发的功能

交换机的特点
1、消除碰撞
2、交换机将链路彼此隔离，不同的链路可以以不同的速率，介质运行
大型网络适合用路由器组织，小型网络可以用交换机组织

*****************无线网络*******************
无线和移动是不同的概念，无限代表可以不通过网线接入网，移动代表设备易于移动
无限链路，较为流行的有802.11和4G
基站：只存在于无线移动网络中的概念，向与之关联（1、在覆盖范围内，2、使用基站收发数据）的主机收发数据。在主机和更大的网络之间提供链路层中继的作用
WiFi接入点，蜂窝信号塔都是基站
无线网络的特征
1、通过电磁波传递信号，在穿越物体时信号递减
2、同一频段的信号会互相干扰（电动机，微波）
2、发送方和接收方的电磁波可能会经过不同长度的路径
CDMA码分多址
//TODO
802.11
基本服务集：包含一个或多个（无线站点）主机和一个中央基站，每个无线站点有一个6字节的MAC地址，每个AP的无线接口也有一个MAC地址
在安装AP时，管理员为AP分配一个服务集ID（WiFi名字），一个信道号
在普通的2.4GHz WiFi中有11个重叠的信道
与AP关联
802.11要求每个AP周期性的发送信标帧，内含SSID + MAC，无线站点通过扫描11个信道找出位于该区域的所有信标帧
主动扫描：AP发送信标帧，主机向选择的AP请求关联
被动扫描，主机广播探测帧，AP发送探测响应，主机请求连接
一旦关联，主机通过AP向子网进行DHCP请求
鉴别身份的方式
1、基于MAC鉴别
2、SSID + 口令（WiFi密码）
不同的802.11
table



*****************无线网络*******************
*****************无线网络*******************
*****************无线网络*******************


